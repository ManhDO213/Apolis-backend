<div class="content-page">
  <div class="content">
    <!-- Start Content-->
    <div class="container-fluid">
      <div class="card p-3">
        <div class="row">


          <!-- Left col -->
          <div class="col-lg-3 connectedSortable">
            <img class="d-block w-100" src="<%= account[0].profileData.avatarUrl %>">
            <p style="color: aliceblue;" id="_id"><%= account[0]._id %></p>
          </div>
          <!-- /.Left col -->
          <!-- right col (We are only adding the ID to make the widgets sortable)-->
          <div class="col-lg-9 connectedSortable">
            <div class="row">
              <div class="col-lg-6">
                <div class="row">
                  <div class="col-lg-12">
                    <h4 class="m-0">
                      <%= account[0].profileData.name %>
                    </h4>
                    <p class="text-muted"><i>
                        <%= account[0].profileData.introduce %>
                      </i>
                    </p>
                  </div>
                  <div class="col-sm-6 invoice-col">
                    <strong>Giới tính: </strong><br>
                    <address>
                      <% if(account[0].profileData.gender=="MALE" ) {%>
                        <address>
                          Nam
                        </address>
                        <%} else{ %>
                          <address>
                            Nữ
                          </address>
                          <%}%>
                    </address>
                  </div>
                  <div class="col-sm-6 invoice-col">
                    <strong>Email: </strong><br>
                    <address>
                      <%= account[0].email %>
                    </address>
                  </div>
                  <div class="col-sm-6 invoice-col">
                    <strong>Trạng thái: </strong><br>
                    <address>
                      <% if(account[0].status=="ACTIVE" ) {%>
                        <address class="text-success">
                          Đã kích hoạt
                        </address>
                        <%} else{ %>
                          <address class="text-danger">
                            Chưa kích hoạt
                          </address>
                          <%}%>
                    </address>
                  </div>
                  <div class="col-sm-6 invoice-col">
                    <strong>Số điện thoại: </strong><br>
                    <address>
                      <%= account[0].phoneNumber %>
                    </address>
                  </div>
                </div>
              </div>

              <div id="loading" class="loading-container">
                <div class="loading-spinner">
                  <i class="fas fa-spinner fa-spin"></i>
                </div>
              </div>

              <div id="dialog" class="dialog-container">
                <div class="dialog-content">
                  <span id="dialog-message"></span>
                  <button onclick="hideDialog()">Ok</button>
                </div>
              </div>

              <div class="col-lg-6">
                <strong>Kỹ năng:</strong><br>
                <address>
                  <% account[0].profileData.skills.forEach((row)=> { %>
                    <b>- </b>
                    <%= row %> <br>
                      <% }) %>
                </address>
              </div>
            </div>
            <!-- /.col -->
          </div>
        </div>



        <!-- right col -->
      </div>
      <hr>
      <div class="row gap-4">
        <div class="col-md-5 ml-3">
          <h4>Học vấn</h4>
          <% if(account[0].profileData.educations==undefined) { %>
            <a href="#" class="btn btn-secondary width-lg">Chưa cập nhật</a>
            <% } else { %>
              <div class="timeline">
                <article class="timeline-item alt">
                  <div class="time-show first">
                    <a href="#" class="btn btn-secondary width-lg">
                      <%= moment(account[0].profileData.educations.dateStart).format('DD MMM. YYYY') %>
                    </a>
                  </div>
                </article>
                <% account[0].profileData.educations.listEducation.forEach((row)=> { %>
                  <article class="timeline-item alt">
                    <div class="timeline-desk">
                      <div class="panel">
                        <div class="panel-body">
                          <span class="arrow-alt"></span>
                          <span class="timeline-icon bg-danger"><i class="mdi mdi-circle"></i></span>
                          <h4 class="text-danger mt-0">
                            <%= row.title %>
                          </h4>
                          <p>
                            <%= row.description %>
                          </p>
                        </div>
                      </div>
                    </div>
                  </article>

                  <article class="timeline-item ">
                    <div class="timeline-desk">
                      <div class="panel">
                        <div class="panel-body">
                          <span class="arrow"></span>
                          <span class="timeline-icon bg-success"><i class="mdi mdi-circle"></i></span>
                          <h4 class="text-success mt-0">2 hours ago</h4>
                          <p class="timeline-date text-muted"><small>08:25 am</small></p>
                          <p>consectetur adipisicing elit. Iusto, optio, dolorum <a href="#">John deon</a> provident
                            rerum
                            aut
                            hic quasi placeat iure tempora laudantium </p>
                        </div>
                      </div>
                    </div>
                  </article>
                  <% }) %>
              </div>
              <% } %>
        </div>

        <div class="col-lg-1">
          <div class="vertical-line"></div>
        </div>

        <div class="col-md-5">
          <h4>Kinh nghiệm làm việc</h4>
          <% if(account[0].profileData.experiences==undefined) { %>
            <a href="#" class="btn btn-secondary width-lg">Chưa cập nhật</a>
            <% } else { %>
              <div class="timeline">
                <% account[0].profileData.experiences.forEach((row)=> { %>
                  <article class="timeline-item alt">
                    <div class="time-show first">
                      <a href="#" class="btn btn-secondary width-lg">
                        <%= moment(row.dateStart).format('DD MMM. YYYY') %>
                      </a>
                    </div>
                  </article>
                  <article class="timeline-item alt">
                    <div class="timeline-desk">
                      <div class="panel">
                        <div class="panel-body">
                          <% row.listCompany.forEach((data)=> { %>
                            <span class="arrow-alt"></span>
                            <span class="timeline-icon bg-danger"><i class="mdi mdi-circle"></i></span>
                            <h4 class="text-danger mt-0">
                              <%= data.nameCompany %>
                            </h4>
                            <% data.role.forEach((data2)=> { %>
                              <p>
                                <%= data2 %>
                              </p>
                              <% }) %>
                        </div>
                        <% }) %>
                      </div>
                    </div>
                  </article>
                  <article class="timeline-item ">
                    <div class="timeline-desk">
                      <div class="panel">
                        <div class="panel-body">
                          <span class="arrow"></span>
                          <span class="timeline-icon bg-success"><i class="mdi mdi-circle"></i></span>
                          <h4 class="text-success mt-0">2 hours ago</h4>
                          <p class="timeline-date text-muted"><small>08:25 am</small></p>
                          <p>consectetur adipisicing elit. Iusto, optio, dolorum <a href="#">John deon</a> provident
                            rerum
                            aut
                            hic quasi placeat iure tempora laudantium </p>
                        </div>
                      </div>
                    </div>
                  </article>
                  <% }) %>
              </div>
              <% } %>
        </div>
      </div>
    </div>
    

    <% if(account[0].status=="ACTIVE" ) {%>
      <a href="/admin/teacher/edit-account-teacher">
        <button type="button" class="btn btn-info waves-effect waves-light float-end">
          Sửa<span class="btn-label-right"><i class="mdi mdi-alert-circle-outline"></i></span>
        </button>
      </a>
      <button type="button" class="btn btn-danger waves-effect waves-light float-end mr-1" data-bs-toggle="modal"
        data-bs-target="#lockModal">
        Khóa<span class="btn-label-right"><i class="mdi mdi-close-circle-outline"></i></span>
      </button>
      <!-- modal-lock  -->
      <div class="modal modal-lock" id="lockModal">
        <div class="modal-dialog">
          <div class="modal-content">
            <form>
              <!-- Modal Header -->
              <div class="modal-header">
                <h4 class="modal-title">Thông báo!</h4>
                <button type="button" class="close" data-dismiss="modal-lock">&times;</button>
              </div>

              <!-- Modal body -->
              <div class="modal-body">
                <div class="form-group">
                  <label>Lí do khoá ?</label>
                  <textarea id="lockReasonInput" class="form-control" rows="4" name="lockReason"
                    placeholder=""></textarea>
                </div>
              </div>

              <!-- Modal footer -->
              <div class="modal-footer">
                <button type="button" class="btn btn-success" data-dismiss="modal-lock">Huỷ</button>
                <input type="hidden" name="idAccount">
                <button type="submit" class="btn btn-outline-danger" data-dismiss="modal-lock"
                  id="close-teacher">Khoá</button>
            </form>
          </div>
        </div>
      </div>
      <%} else{ %>
        <button type="button" class="btn btn-success waves-effect waves-light float-end mr-1" data-bs-toggle="modal"
          data-bs-target="#openModal">
          Mở Khóa<span class="btn-label-right"><i class="mdi mdi-check-all"></i></span>
        </button>
        <!-- modal-open  -->
        <div class="modal" id="openModal">
          <div class="modal-dialog">
            <div class="modal-content">
              <form action="/admin/teacher/unlock-account/<%= account[0]._id %>" method="POST">
                <!-- Modal Header -->
                <div class="modal-header">
                  <h4 class="modal-title">Thông báo!</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                  <div class="form-group">
                    <label>Lí do mở khoá ?</label>
                    <textarea id="lockReasonInput" class="form-control" rows="4" name="lockReason"
                      placeholder=""></textarea>
                  </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                  <button type="button" class="btn btn-success" data-dismiss="modal">Huỷ</button>
                  <input type="hidden" name="idAccount">
                  <button type="submit" class="btn btn-outline-success">Mở Khoá</button>
              </form>
            </div>
          </div>
        </div>
        <%}%>

  </div>
</div>


<script>
  document.getElementById("lockForm").addEventListener("submit", function (event) {
    event.preventDefault();
    const status = document.getElementById("statusCode").value;
    const message = "Đang có khóa học , Không thể khoá !";

    if (status === 300) {
      $('#lockModal').modal('hide');
      document.getElementById("customModalMessage").textContent = message;
      $('#customModal').modal('show');
    } else {
      this.submit();
    }
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var isSuccess = false;
    const baseURL = window.location.protocol + '//' + window.location.host;
    const upload = document.getElementById('close-teacher');
    const idAccount = document.getElementById('_id').textContent;
    console.log(`[lock-teacher] idAccount -> ${idAccount}`);
    upload.addEventListener('click', function (event) {
      event.preventDefault();
      var objectJson = {};

      const lockReason = document.getElementById('lockReasonInput');
      objectJson.lockReason = lockReason.value;
      console.log(`[lock-teacher] objectJson -> ${JSON.stringify(objectJson)}`);

      showLoading()
      fetch(`${baseURL}/admin/teacher/lock-account/${idAccount}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(objectJson)
      }).then(response => {
        response.json().then(body => {
          const statusCode = response.status;
          if (statusCode == 200) {
            isSuccess = true;
            hideLoading();
            showDialog(body.message);
          } else {
            isSuccess = false;
            hideLoading();
            showDialog(body.message);
          }
        });
      }).catch(error => {
        isSuccess = false;
        console.error(error);
      });
    });

  });

  function showLoading() {
    document.getElementById("loading").style.display = "block";
  }

  function hideLoading() {
    document.getElementById("loading").style.display = "none";
  }

  function showDialog(message) {
    document.getElementById("dialog-message").textContent = message;
    document.getElementById("dialog").style.display = "block";
  }

  function hideDialog() {
    document.getElementById("dialog").style.display = "none";
    if (isSuccess) {
      form.reset();
      isSuccess = false;
    }
  }
</script>