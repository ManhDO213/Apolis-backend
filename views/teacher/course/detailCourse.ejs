<div class="content-page">
    <div class="content">

        <!-- Start Content-->
        <div class="container-fluid">
            <div class="row">
                <div class="col-xl-12">
                    <div class="card">
                        <div class="card-body">
                            <section class="content">
                                <!-- /.container-fluid -->
                                <div class="row">
                                    <!-- Left col -->
                                    <h2>
                                        <%= course.course.name %>
                                    </h2>
                                    <section class="col-lg-5 connectedSortable">
                                        <div class="invoice p-3 mb-3">
                                            <!-- /.col -->
                                            <div id="carouselExampleIndicators" class="carousel slide"
                                                data-ride="carousel">
                                                <div class="carousel-inner">
                                                    <% course.course.photoUrls.forEach((value,index)=>{ %>
                                                        <%if(index==0){%>
                                                            <div class="carousel-item active">
                                                                <img class="d-block w-100" src="<%=value%>"
                                                                    style="height: 320px;" />
                                                            </div>
                                                            <%}else%>
                                                                <%{%>
                                                                    <div class="carousel-item">
                                                                        <img class="d-block w-100"
                                                                            style="height: 320px;" src="<%=value%>" />
                                                                    </div>
                                                                    <%}%>
                                                                        <% }) %>
                                                                            <a class="carousel-control-prev"
                                                                                href="#carouselExampleIndicators"
                                                                                role="button" data-slide="prev">
                                                                                <span class="carousel-control-prev-icon"
                                                                                    aria-hidden="true"></span>
                                                                                <span class="sr-only">Previous</span>
                                                                            </a>
                                                                            <a class="carousel-control-next"
                                                                                href="#carouselExampleIndicators"
                                                                                role="button" data-slide="next">
                                                                                <span class="carousel-control-next-icon"
                                                                                    aria-hidden="true"></span>
                                                                                <span class="sr-only">Next</span>
                                                                            </a>
                                                </div>
                                            </div>
                                        </div>

                                    </section>
                                    <!-- /.Left col -->
                                    <section class="col-lg-7 connectedSortable">
                                        <div class="row"
                                            style="padding-left: 15px; padding-right: 15px;margin-top: 15px;">
                                            <div class="col-sm-6 invoice-col">
                                                <strong>Học phí: </strong><br />
                                                <address>
                                                    <%= course.course.feeCoin %> (VNĐ)
                                                </address>
                                            </div>

                                            <div class="col-sm-6 invoice-col">
                                                <a href="" class="text-decoration-none text-black">
                                                    <strong>Học viên đăng ký: </strong><br />
                                                    <address>
                                                        <%= course.course.numRegister %>
                                                    </address>
                                                </a>
                                            </div>

                                            <div class="col-sm-6 invoice-col">
                                                <strong>Thể loại: </strong><br />
                                                <address>
                                                    <%= course.course.category %>
                                                </address>
                                            </div>

                                            <div class="col-sm-6 invoice-col">
                                                <strong>Số buổi học: </strong><br />
                                                <address>
                                                    <%= course.course.totalSession %>
                                                </address>
                                            </div>

                                            <div class="col-sm-6 invoice-col">
                                                <strong>Giới hạn học viên: </strong><br />
                                                <address>
                                                    <%= course.cycle_courses.minStudent %> - <%=
                                                            course.cycle_courses.maxStudent %>
                                                </address>
                                            </div>

                                            <div class="col-sm-6 invoice-col">
                                                <strong>Thời gian đăng kí: </strong><br />
                                                <% const formatDate=(dateString)=> {
                                                    const date = new Date(dateString);
                                                    const day = date.getDate();
                                                    const month = date.getMonth() + 1;
                                                    const year = date.getFullYear();
                                                    return `${day}/${month}/${year}`;
                                                    };
                                                    %>
                                                    <address>
                                                        <%= formatDate(course.cycle_courses.registrationPeriod.startDate)%> -
                                                            <%= formatDate(course.cycle_courses.registrationPeriod.endDate)%>
                                                            
                                                    </address>
                                            </div>

                                            <div class="col-sm-6 invoice-col">
                                                <strong>Thời gian dạy học: </strong><br />
                                                <address>
                                                    <%= formatDate(course.cycle_courses.startDate) %> - <%=
                                                            formatDate(course.cycle_courses.endDate) %>
                                                </address>
                                            </div>

                                            <div class="col-sm-6 invoice-col">
                                                <strong>Trạng thái: </strong><br />
                                                <% if (course.cycle_courses.status==="APPROVED" ) { %>
                                                    <address class="text-success">Đang hoạt động</address>
                                                    <% } else if (course.cycle_courses.status==="REJECT" ) { %>
                                                        <address class="text-danger">Bị từ chối</address>
                                                        <% } else if (course.cycle_courses.status==="PENDING" ) { %>
                                                            <address class="text-primary">
                                                                </addressclass>Chờ phê duyệt</address>
                                                            <% } %>
                                            </div>

                                            <div class="col-sm-6 invoice-col">
                                                <strong>
                                                    <a href="/teacher/student/score-board">
                                                        <i class="fab fa-wpforms"></i>
                                                          Bảng điểm
                                                    </a>
                                                </strong><br>
                                            </div>

                                        </div>
                                    </section>
                                    <!-- right col -->
                                </div>

                                <div class="col-sm-12 invoice-col">
                                    <strong>Link google meet: </strong><br />
                                    <address>
                                        <a href="<%= course.cycle_courses.googleMeetUrl %>" target="_blank">
                                            <%= course.cycle_courses.googleMeetUrl %>
                                        </a>
                                    </address>
                                </div>

                                <div class="col-sm-12 invoice-col">
                                    <strong>Mô tả khóa học: </strong><br />
                                    <address>
                                        <div class="text-truncate">
                                            <%= course.course.description %>
                                        </div>
                                            <br>
                                            <a href="<%= course.course.videoUrls %>" target="_blank">
                                                <i class="fab fa-youtube"></i>
                                                Video
                                            </a>
                                    </address>

                                </div>

                            </section>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <section class="content"
                                style="padding-left: 15px;padding-right:15px;flex-direction: column;display: flex;">
                                <h4>Lịch học</h4>

                                <div class="accordion custom-accordion" id="custom-accordion-one">
                                    <div class="card mb-0">
                                        <% course.schedules.forEach((value, index)=> { %>
                                        <div class="card-header" id="headingNine">
                                            <h6 class="m-0 position-relative">
                                                <a class="custom-accordion-title text-reset d-block collapsed"
                                                    data-bs-toggle="collapse" href="#collapseNine<%= index %>" aria-expanded="false"
                                                    aria-controls="collapseNine">
                                                    Buổi học số <%= value.session %>
                                                    <i class="mdi mdi-chevron-down accordion-arrow"></i>
                                                </a>
                                            </h6>
                                        </div>

                                        <div id="collapseNine<%= index %>" class="collapse" aria-labelledby="headingFour"
                                            data-bs-parent="#custom-accordion-one">
                                            <div class="card-body">
                                                <strong>
                                                    <% var currentTime = moment(); %>
                                                    <% var startDate = moment(formatDate(value.startDate), "DD/MM/YYYY HH:mm"); %>                                         
                                                    <% var endDate = moment(moment(value.endDate).format('HH:mm'), "HH:mm"); %>
                                                    <% var timeDiff = moment.duration(currentTime.diff(startDate)).asMinutes(); %>
                                                    <% var isWithin15Minutes = currentTime.isBetween(startDate, startDate.clone().add(15, 'minutes')); %>
                                                    <% if (currentTime.isBetween(startDate, endDate) ) { %>
                                                        <a href="/teacher/student/attendance/<%= course.course._id %>/<%= value._id %>">
                                                            <i class="fab fa-wpforms"></i>
                                                            Điểm danh
                                                        </a> 
                                                        <% } else { %>
                                                            <a href="$" data-bs-target="#no-<%= value._id %>" data-bs-toggle="modal">
                                                                <i class="fab fa-wpforms"></i>
                                                                Điểm danh
                                                            </a>                                                            
                                                            <% } %>
                                                             <!-- modal từ chối -->
                                                            <div class="modal fade" id="no-<%= value._id %>" tabindex="-1"
                                                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <h5 class="modal-title" id="exampleModalLabel">Thông báo
                                                                            </h5>
                                                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                                                aria-label="Close"></button>
                                                                        </div>
                                                                        <div class="modal-body">
                                                                           Chưa đến giờ điểm danh !
                                                                        </div>
                                                                        <div class="modal-footer">
                                                                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Hủy</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                </strong><br>
                                                <strong>Ngày:</strong>
                                                <span><%= formatDate(value.startDate) %></span><br>
                                                <strong>Thời gian:</strong>
                                                <span>  <%= moment(value.startDate).format('HH:mm') %> -
                                                    <%= moment(value.endDate).format('HH:mm') %></span><br>
                                                <strong>Link google meet: </strong>
                                                <span>
                                                    <a href="<%= course.cycle_courses.googleMeetUrl %>" target="_blank">
                                                        <%= course.cycle_courses.googleMeetUrl %>
                                                    </a>
                                                </span><br>
                                            </div>
                                        </div>
                                        <% }) %>                                        
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <section class="content"
                                style="padding-left: 15px;padding-right:15px;flex-direction: column;display: flex;">
                                <h4>Bài giảng</h4>

                                <div class="accordion custom-accordion" id="custom-accordion-one">
                                    <% function getId(url) {
                                        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                                        const match = url.match(regExp);
                                        return (match && match[2].length === 11)
                                          ? match[2]
                                          : null;
                                    } %>
                                    <% course.document_courses.forEach((value, index)=> { %>
                                        <div class="card mb-0">
                                            <div class="card-header" id="headingNine">
                                                <h6 class="m-0 position-relative">
                                                    <a class="custom-accordion-title text-reset d-block collapsed"
                                                        data-bs-toggle="collapse" href="#collapseNine<%= index %>"
                                                        aria-expanded="false" aria-controls="collapseNine">
                                                        <%= value.documents[0].title %> <i
                                                                class="mdi mdi-chevron-down accordion-arrow"></i>
                                                    </a>
                                                </h6>
                                            </div>

                                            <div id="collapseNine<%= index %>" class="collapse" aria-labelledby="headingFour"
                                                data-bs-parent="#custom-accordion-one">
                                                <div class="card-body">
                                                    <iframe width="320" height="300"  style="background-color: darkgrey;width: 70%;align-self: center;" 
                                                    src="//www.youtube.com/embed/<%= getId(value.documents[0].url) %>">
                                                    </iframe>
                                                    <h5>Nội dung:</h5>
                                                    <p class="text-muted">
                                                        <%= value.documents[0].description %>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <% }) %>
                                            <!--  -->
                                </div>
                            </section>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <section class="content"
                                style="padding-left: 15px;padding-right:15px;flex-direction: column;display: flex;">
                                <h4>Quiz</h4>

                                <div class="accordion custom-accordion" id="custom-accordion-one">
                                    <!--  -->
                                    <ul class="nav nav-tabs">
                                        <% course.course.quizes_courses.forEach((value, index)=> { %>
                                            <li class="nav-item">
                                                <a href="#quiz-<%= value.session %>" data-bs-toggle="tab"
                                                    aria-expanded="false"
                                                    class="nav-link <%= index === 0 ? 'active' : '' %>">
                                                    Quiz <%= value.session %>
                                                </a>
                                            </li>
                                            <% }) %>
                                    </ul>
                                    <div class="tab-content">
                                        <% course.course.quizes_courses.forEach((value, index)=> {
                                            var sttQuestion = 0;
                                            %>
                                            <div class="tab-pane <%= index === 0 ? 'show active' : '' %>"
                                                id="quiz-<%= value.session %>">
                                                <% course.course.question_courses.forEach((item, indexSecond)=> { %>
                                                    <% if (value._id.toString()==item.courseQuizId.toString()) {
                                                        sttQuestion++; %>
                                                        <div class="card mb-0">
                                                            <div class="card-header" id="headingNine">
                                                                <h6 class="m-0 position-relative">
                                                                    <a class="custom-accordion-title text-reset d-block collapsed"
                                                                        data-bs-toggle="collapse"
                                                                        href="#collapseNine<%= index %><%= indexSecond %>"
                                                                        aria-expanded="false"
                                                                        aria-controls="collapseNine">
                                                                        Câu hỏi <%= sttQuestion %> <i
                                                                                class="mdi mdi-chevron-down accordion-arrow"></i>
                                                                    </a>
                                                                </h6>
                                                            </div>

                                                            <div id="collapseNine<%= index %><%= indexSecond %>"
                                                                class="collapse" aria-labelledby="headingFour"
                                                                data-bs-parent="#custom-accordion-one">
                                                                <div class="card-body">
                                                                    <h6>
                                                                        <%= item.question %>
                                                                    </h6>
                                                                    <% item.answers.forEach((answer, indexAnswer)=> { %>
                                                                        <div class="form-check">
                                                                            <input type="radio"
                                                                                id="customRadio<%= index %><%= indexSecond %><%= indexAnswer %>"
                                                                                name="customRadio<%= index %><%= indexSecond %>"
                                                                                class="form-check-input" disabled <% if
                                                                                (answer.isCorrect) { %>
                                                                            checked
                                                                            <% } %>
                                                                                >
                                                                                <label class="form-check-label"
                                                                                    for="customRadio<%= index %><%= indexSecond %>">
                                                                                    <%= answer.value %>
                                                                                </label>
                                                                        </div>
                                                                        <% }) %>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                            <% }) %>
                                            </div>
                                            <% }) %>
                                    </div>
                                    <!--  -->
                                </div>
                            </section>
                        </div>
                    </div>
                    <% if (course.cycle_courses.status==="APPROVED" ) { %>
                        <a href="/teacher/course/edit-course/<%= course.course._id %>">
                        <button type="button" class="btn btn-info waves-effect waves-light float-end">
                            Sửa<span class="btn-label-right"><i class="mdi mdi-alert-circle-outline"></i></span>
                        </button>
                        </a>
                        <% } else if (course.cycle_courses.status==="REJECT" ) { %>
                            <button type="button" class="btn btn-danger waves-effect waves-light float-end"
                                data-bs-toggle="modal" data-bs-target="#deleteCourse">
                                Xóa<span class="btn-label-right"><i class="mdi mdi-close-circle-outline"></i></span>
                            </button>
                            <button type="button" class="btn btn-success waves-effect waves-light float-end mr-1"
                                data-toggle="modal" data-target="#approve-<%= course.cycle_courses._id %>">
                                Phê duyệt<span class="btn-label-right"><i class="mdi mdi-check-all"></i></span>
                            </button>
                            <% } else if (course.cycle_courses.status==="PENDING" ) { %>
                                <button type="button" class="btn btn-danger waves-effect waves-light float-end"
                                    data-bs-toggle="modal" data-bs-target="#no-<%= course.cycle_courses._id %>">
                                    Từ chối<span class="btn-label-right"><i
                                            class="mdi mdi-close-circle-outline"></i></span>
                                </button>
                                <button type="button" class="btn btn-success waves-effect waves-light float-end mr-1"
                                    data-toggle="modal" data-target="#approve-<%= course.cycle_courses._id %>">
                                    Phê duyệt<span class="btn-label-right"><i class="mdi mdi-check-all"></i></span>
                                </button>
                                <% } %>
                                    <!-- modal phê duyệt -->
                                    <div class="modal fade" id="approve-<%= course.cycle_courses._id %>" tabindex="-1"
                                        role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">Phê duyệt
                                                        khóa
                                                        học</h5>
                                                    <button type="button" class="close" data-dismiss="modal"
                                                        aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    Bạn có chắc muốn phê duyệt khóa học
                                                    này không ?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Close</button>
                                                    <form
                                                        action="/admin/course/approve-course/<%= course.cycle_courses._id %>"
                                                        method="POST">
                                                        <input type="hidden" name="idCourse">
                                                        <button type="submit" class="btn btn-primary">Save</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- modal từ chối duyệt -->
                                    <div class="modal fade" id="no-<%= course.cycle_courses._id %>" tabindex="-1"
                                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">Phê duyệt khóa học
                                                    </h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    Bạn có chắc từ chối phê duyệt khóa học này không ?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Hủy</button>
                                                    <form
                                                        action="/admin/course/reject-course/<%= course.cycle_courses._id %>"
                                                        method="POST">
                                                        <input type="hidden" name="idCourse">
                                                        <button type="submit" class="btn btn-primary">Lưu</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- modal xóa khóa học -->
                                    <div class="modal fade" id="deleteCourse" tabindex="-1"
                                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">Phê duyệt khóa học
                                                    </h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    Bạn có chắc chắn xóa khóa học này không ?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Hủy</button>
                                                    <button type="button" class="btn btn-danger">Xóa</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                </div><!-- end col -->

            </div>
            <!-- end row -->

        </div> <!-- container-fluid -->

    </div> <!-- content -->

</div>